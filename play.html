<html>
<head>
<link rel="icon" 
      type="image/png" 
      href="favicon.png">
<title>flickgame.org</title>
<style>
:root {
    --bg_color: #000000;
    --fg_color: #ffffff;
}

#header h1 {
  padding:0;
  margin:0;
  line-height: 40px;
}
#header {
  position:absolute;
  left:0px;
  right:0px;
  top:0px;
  height:40px;
  background-color: var(--bg_color);
  color:var(--fg_color);
  text-align: center;
  padding: 0px;
  margin:0px;
  border:0px;
}

a {
  color:var(--fg_color);
}

#content {
  position: absolute;
  top:40px;
  bottom:30px;
  left:0px;
  right:0px;
  background-color: var(--bg_color);
  text-align: center;
  padding:0;
  margin:0;
}


#content canvas {
 top:0;
 bottom:0;
 left:0;
 right:0;
 padding: 0;
 margin:0; 
 image-rendering: optimizeSpeed;
 image-rendering: -moz-crisp-edges;
 image-rendering: -webkit-optimize-contrast;
 image-rendering: -o-crisp-edges;
 image-rendering: pixelated;
 -ms-interpolation-mode: nearest-neighbor;
  touch-action: manipulation;
}
#hackLink {
  position: absolute;
  right:10px;
  float: right;
}

#homelink {
  float: center;
}
#footer {
  position:absolute;
  left:0px;
  right:0px;
  bottom:0px;
  height:30px;
  margin:0;
  padding:0;
  background-color: var(--bg_color);
  color:var(--fg_color);
  text-align: center;
  padding: 0;
  line-height: 30px;
}
</style>
<script>

<!--__EmbedBegin__-->
var embeddedDat="__EMBED__";
<!--__EmbedEnd__-->

function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,    
    function(m,key,value) {
      vars[key] = value;
    });
    return vars;
}

var urlVars = getUrlVars();
if (!("frameCount" in urlVars)){
  urlVars["frameCount"]=1;
}
if (!("animationLength" in urlVars)){
  urlVars["animationLength"]=0.5;
}

urlVars["frameCount"]=parseFloat(urlVars["frameCount"])
urlVars["animationLength"]=parseFloat(urlVars["animationLength"])
var frameCount=urlVars["frameCount"];
var animationLength=urlVars["animationLength"];

if(urlVars["a"]==="1"){
  frameCount=8;
  animationLength=0.5;
}
var showAnimation = frameCount>1;


var animating=false;
var zoom=1;
var currentIndex=0;
function redraw(){
  console.log("resized "+window.innerWidth +"x"+window.innerHeight);  
  mainCanvas.width=mainCanvasContainer.clientWidth;
  mainCanvas.height=mainCanvasContainer.clientHeight;
  mainCanvasCtx.width=mainCanvasContainer.clientWidth;
  mainCanvasCtx.height=mainCanvasContainer.clientHeight;

  if (images.length>0){

    mainCanvasCtx.imageSmoothingEnabled = false;
    mainCanvasCtx.mozImageSmoothingEnabled = false;
    mainCanvasCtx.oImageSmoothingEnabled = false;
    mainCanvasCtx.webkitImageSmoothingEnabled = false;
    mainCanvasCtx.msImageSmoothingEnabled = false;

    var w = mainCanvasCtx.width;
    var h = mainCanvasCtx.height;
    var wd = w/160.0;
    var hd = h/100.0;
    zoom=1;
    if (wd<hd){
      zoom=wd;//Math.floor(wd);
    } else {
      zoom=hd;//Math.floor(hd);
    }
    if(zoom<1){
      zoom=1;
    }
    var dx=(w-160*zoom)/2;
    var dy=(h-100*zoom)/2;
    mainCanvasCtx.fillStyle=gameState.background_color;
    mainCanvasCtx.fillRect(0,0,w,h);
    if (curCanvasToDraw===null){
      mainCanvasCtx.drawImage(images[currentIndex],0,0,160,100,dx,dy,160*zoom,100*zoom);
    } else {
      mainCanvasCtx.drawImage(curCanvasToDraw,0,0,160,100,dx,dy,160*zoom,100*zoom);
    }
  } else {    
    mainCanvasCtx.fillStyle="#ff0000";
    mainCanvasCtx.fillRect(0,0,mainCanvas.width/2,mainCanvas.height/2);
    mainCanvasCtx.fillStyle="#00ff00";
    mainCanvasCtx.fillRect(mainCanvas.width/2,0,mainCanvas.width/2,mainCanvas.height/2);
    mainCanvasCtx.fillStyle="#ff00ff";
    mainCanvasCtx.fillRect(0,mainCanvas.height/2,mainCanvas.width/2,mainCanvas.height/2);
    mainCanvasCtx.fillStyle="#00ffff";
    mainCanvasCtx.fillRect(mainCanvas.width/2,mainCanvas.height/2,mainCanvas.width/2,mainCanvas.height/2);
  }
}


  function getCoords(e) {
    var x,y; 
    if(e.offsetX) {
        x = e.offsetX;
        y = e.offsetY;
    }
    else if(e.layerX) {
        x = e.layerX;
        y = e.layerY;
    }

    return [x,y];
  }

  var target=0;

  function printNonZeros(a,stack){
    var count=0;
    for (var i=0;i<160;i++){
      for (var j=0;j<100;j++){
        if (a[j][i]!==null)
          count++;
      }
    }
    window.console.log(count + " non-zero entries.");
    window.console.log("stack length " + stack.length+".");
  }

  var hex=['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f']

  function calcHeatmap(cal,col,fromCal){
    var map = []
    var stack = []
    var c = hex[col]

    //initialize
    for (var j=0;j<100;j++){
      for (var i=0;i<160;i++){
        if (cal[i+160*j]===c){
          var entry = [0,i,j]
          map.push([0,i,j])
          stack.push([i,j,0,i,j])
        } else {
          map.push(null)
        }
      }
    }

    //should replace this with a center of mass calculation from the old one
    if (stack.length===0){
      var cx=0;
      var cy=0;
      var count=0;
      for (var i=0;i<160;i++){
        for (var j=0;j<100;j++){
          if (fromCal[i+160*j]===c){
            cx+=i;
            cy+=j;
            count++;
          }
        }
      }
      if (count>0){
        cx=Math.round(cx/count);
        cy=Math.round(cy/count);
        for (var j=0;j<100;j++){
          for (var i=0;i<160;i++){
            map[i+160*j]=[0,cx,cy];
          }
        }
      }
    }

    //propagate
    while(stack.length>0){
      var entry = stack.shift();
      //[fromx,fromy,dist,tox,toy]
      var x0=entry[0];
      var y0=entry[1];
      var d0=entry[2];
      var xtarget=entry[3];
      var ytarget=entry[4];
      var d1=d0+1;
      var neighbours = [[x0-1,y0],[x0+1,y0],[x0,y0-1],[x0,y0+1]];
      for (var i=0;i<4;i++){
        var n = neighbours[i];
        var nx=n[0];
        var ny=n[1];
        if (nx<0||ny<0||nx>=160||ny>=100){
          continue;
        }
        var existing = map[nx+160*ny];
        if (existing===null||d1<existing[0]){
          map[nx+160*ny]=[d1,xtarget,ytarget]
          stack.push([nx,ny,d1,xtarget,ytarget])
        }
      }
    }

    return map;
  }

  function generateParticleMotions(sourceCanvas,targetHeatMap,colIndex,particles,reverse){
    if (reverse){
      var c = hex[colIndex];
      for (var i=0;i<160;i++){
        for (var j=0;j<100;j++){
          var pixel = sourceCanvas[i+160*j];
          if (pixel===c){
            //[d,tx,ty]
            var target = targetHeatMap[i+160*j];
            var tx = target[1];
            var ty = target[2];
            if (i!==tx||j!==ty)
              particles.push([tx,ty,i,j])
          }
        }
      }
    } else {
      var c = hex[colIndex];
      for (var i=0;i<160;i++){
        for (var j=0;j<100;j++){
          var pixel = sourceCanvas[i+160*j];
          if (pixel===c){
            //[d,tx,ty]
            var target = targetHeatMap[i+160*j];
            var tx = target[1];
            var ty = target[2];
            particles.push([i,j,tx,ty])
          }
        }
      }
    }
  }

  function generateFrame(sourceImage,particleMap,progress){
    var frame = [];
    for (var j=0;j<100;j++){
      for (var i=0;i<160;i++){
        frame.push(sourceImage[i+160*j]);
      }
    }

    for (var cIndex=0;cIndex<particleMap.length;cIndex++){      
      var c = hex[cIndex]
      var particles = particleMap[cIndex]
      for (var i=0;i<particles.length;i++){
        var p = particles[i]
        var x0=p[0]
        var y0=p[1]
        var x1=p[2]
        var y1=p[3]
        var dx=x1-x0
        var dy=y1-y0
        if (dx!==0||dy!==0){
//          var xt = Math.round(x0+progress*dx+Math.random()*0.5-0.25)
//          var yt = Math.round(y0+progress*dy+Math.random()*0.5-0.25)
          var xt = Math.round(x0+progress*dx)
          var yt = Math.round(y0+progress*dy)
          frame[xt+160*yt]=c;
        }
      }
    }
    return frame;
  }

  function calcTransitionGrids(oldCanvas,newCanvas){
    //generate 32 canvasses, for each color, for each direction
    var particleMaps = []
    for (var i=0;i<16;i++){
      var forwardHeatmap = calcHeatmap(newCanvas,i,oldCanvas);
      window.console.log("generated forward"+i);
      var backwardHeatmap = calcHeatmap(oldCanvas,i,newCanvas);
      window.console.log("generated backward"+i);
      var particles=[]
      var particleMotionsForward = generateParticleMotions(oldCanvas,forwardHeatmap,i,particles,false);
      window.console.log("generated forward particles"+i);
      var particleMotionsBackward = generateParticleMotions(newCanvas,backwardHeatmap,i,particles,true);
      window.console.log("generated backwards particles"+i);
      particleMaps.push(particles);      
    }
    var frames=[];
    frames.push(oldCanvas)
    for (var i=1;i<frameCount;i++){
      var frame = generateFrame(oldCanvas,particleMaps,i/frameCount)
      frames.push(frame);
    }
    frames.push(newCanvas)
    return frames;
  }

  var curCanvasToDraw=null;
  var curAnimationFrames=null;
  function transition(oldIndex,newIndex){
    var oldCanvas = gameState.imageDats[oldIndex];
    var newCanvas = gameState.imageDats[newIndex];
    var frames = calcTransitionGrids(oldCanvas,newCanvas);
    curAnimationFrames = frames;
    return frames;
  }

  function drawNextFrame(){
      curCanvasToDraw=printCanvas(curAnimationFrames[animationIndex])[0];
      redraw();
      animationIndex++;
      if (animationIndex<curAnimationFrames.length){
        setTimeout(drawNextFrame,1000*animationLength/frameCount);
      } else {
        animating=false;
      }
  }
  var animationIndex=1;
  function doAnimation(){
    animating=true;
    animationIndex=1;
    drawNextFrame();
  }

  function mouseDown(e){
    mouseMove(e);
    if (target>0){
      if (showAnimation){
        transition(currentIndex,target-1);
        currentIndex=target-1;
        doAnimation();
      } else {
        currentIndex=target-1;
        redraw();        
      }
      mouseMove(e);
    } 
  }
  function mouseMove(e){

    if (gameState==null){
      return;
    }
    var coords = getCoords(e);

    var w = mainCanvasCtx.width;
    var h = mainCanvasCtx.height;
    var wd = w/160.0;
    var hd = h/100.0;
    zoom=1;
    if (wd<hd){
      zoom=wd;//Math.floor(wd);
    } else {
      zoom=hd;//Math.floor(hd);
    }
    if(zoom<1){
      zoom=1;
    }
    var dx=(w-160*zoom)/2;
    var dy=(h-100*zoom)/2;

    var x=Math.floor((coords[0]-dx)/zoom);
    var y=Math.floor((coords[1]-dy)/zoom);
    target=0;
    if(x>=0&&x<160&&y>=0&&y<100) {
      var ch = gameState.imageDats[currentIndex][x+160*y];
      var colIndex = parseInt(ch,16);
      target=gameState.hyperlinks[currentIndex][colIndex];

      if (gameState.hyperlinks[currentIndex][colIndex]!=0) {
        mainCanvas.style.cursor="pointer";        
      } else {
        mainCanvas.style.cursor="default";        
      }

    } else {
      mainCanvas.style.cursor="default";
    }
    
  }

var mainCanvas;
var mainCanvasCtx;
var mainCanvasContainer;
function init(){
  window.addEventListener('resize', redraw, false);


  mainCanvas=document.getElementById("mainCanvas");
  mainCanvasCtx=mainCanvas.getContext("2d");
  mainCanvasContainer=document.getElementById("content");

  mainCanvas.addEventListener('mousemove', mouseMove,false);
  mainCanvas.addEventListener('mousedown', mouseDown,false);

  redraw();

  getData();

}

var aurl = document.createElement('a');
function qualifyURL(url) {
 aurl.href = url;
 return aurl.href;
}

var gameState;
function loadState(code){
    gameState=JSON.parse(code);
    if (gameState.palette_name === undefined){
      console.log("palette_name not defined, setting to dawnbringer-16");
      gameState.palette_name = "dawnbringer-16";
    }
    if (gameState.background_color === undefined){
      console.log("background_color not defined, setting to #000000");
      gameState.background_color = "#000000";
    }
    if (gameState.foreground_color === undefined){
      console.log("foreground_color not defined, setting to #ffffff");
      gameState.foreground_color = "#ffffff";
    }
    colorPalette = palettes[gameState.palette_name];
}

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}


function strip_http(url) {
   url = url.replace(/^https?:\/\//,'');
   return url;
}

function getData(){ 
  if (embeddedDat[0]!=='_'){
    embeddedDat=decodeURI(embeddedDat);
    loadState(embeddedDat);

    //set background color
    document.documentElement.style.setProperty('--bg_color', gameState.background_color);
    document.documentElement.style.setProperty('--fg_color', gameState.foreground_color);
    
    var homepage=gameState.gameLink;
    var homepageLink = document.getElementById("homeLink");
    homepageLink.innerHTML=strip_http(homepage);
    if (!homepage.match(/^https?:\/\//)) {
      homepage = "http://" + homepage;
    }
    homepageLink.href = homepage;

    renderImages();
    return;
  }
  var id = getParameterByName("p").replace(/[\\\/]/,"");
  if (id===null||id.length===0) {
    console.log("No ID specified in URL.")
    return;
  }

  var githubURL = 'https://api.github.com/gists/'+id;

  var githubHTTPClient = new XMLHttpRequest();
  githubHTTPClient.open('GET', githubURL);
  githubHTTPClient.onreadystatechange = function() {
    if(githubHTTPClient.readyState!=4) {
      return;
    }   
    var result = JSON.parse(githubHTTPClient.responseText);
    if (githubHTTPClient.status===403) {
      console.log(result.message);
    } else if (githubHTTPClient.status!==200&&githubHTTPClient.status!==201) {
      console.log("HTTP Error "+ githubHTTPClient.status + ' - ' + githubHTTPClient.statusText);
    }
    var result = JSON.parse(githubHTTPClient.responseText);
    var code=result["files"]["game.txt"]["content"];
    console.log(code);
    loadState(code);

    var homepage=gameState.gameLink;
    var homepageLink = document.getElementById("homeLink");
    homepageLink.innerHTML=strip_http(homepage);
    if (!homepage.match(/^https?:\/\//)) {
      homepage = "http://" + homepage;
    }
    homepageLink.href = homepage;
  
    var hacklink = document.getElementById("hackLink");

    var url = "index.html?p="+id;
    url=qualifyURL(url);
    hacklink.href=url;
    hacklink.innerHTML="&sdotb; edit";
    renderImages();
  }
  githubHTTPClient.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  githubHTTPClient.send();
}


function RLE_decode(encoded) {
    var output = "";
    for (var i=0;i<encoded.length;i+=2) {
      var count = encoded[i];
      var ch = encoded[i+1];
      for (var j=0;j<count;j++){
        output+=ch;
      }
    }
    return output;
}

var palettes = {
  antiquity16: [
    '#202020', '#2d211e',
    '#452923', '#6d3d29',
    '#b16b4a', '#e89f6e',
    '#e8be82', '#5d7557',
    '#8e9257', '#707b88',
    '#8aa7ac', '#e55d4d',
    '#f1866c', '#d26730',
    '#de9a28', '#e8d8a5'
  ],
  arq16: [
    '#ffffff', '#ffd19d',
    '#aeb5bd', '#4d80c9',
    '#e93841', '#100820',
    '#511e43', '#054494',
    '#f1892d', '#823e2c',
    '#ffa9a9', '#5ae150',
    '#ffe947', '#7d3ebf',
    '#eb6c82', '#1e8a4c'
  ],
  'bubblegum-16': [
    '#16171a', '#7f0622',
    '#d62411', '#ff8426',
    '#ffd100', '#fafdff',
    '#ff80a4', '#ff2674',
    '#94216a', '#430067',
    '#234975', '#68aed4',
    '#bfff3c', '#10d275',
    '#007899', '#002859'
  ],
  colodore: [
    '#000000', '#4a4a4a',
    '#7b7b7b', '#b2b2b2',
    '#ffffff', '#813338',
    '#c46c71', '#553800',
    '#8e5029', '#edf171',
    '#a9ff9f', '#56ac4d',
    '#75cec8', '#706deb',
    '#2e2c9b', '#8e3c97'
  ],
  'color-graphics-adapter': [
    '#000000', '#555555',
    '#aaaaaa', '#ffffff',
    '#0000aa', '#5555ff',
    '#00aa00', '#55ff55',
    '#00aaaa', '#55ffff',
    '#aa0000', '#ff5555',
    '#aa00aa', '#ff55ff',
    '#aa5500', '#ffff55'
  ],
  commodore64: [
    '#000000', '#626262',
    '#898989', '#adadad',
    '#ffffff', '#9f4e44',
    '#cb7e75', '#6d5412',
    '#a1683c', '#c9d487',
    '#9ae29b', '#5cab5e',
    '#6abfc6', '#887ecb',
    '#50459b', '#a057a3'
  ],
  'cretaceous-16': [
    '#313432', '#323e42',
    '#454b4b', '#3a5f3b',
    '#7c4545', '#675239',
    '#625055', '#516b43',
    '#796c64', '#718245',
    '#9e805c', '#998579',
    '#ac9086', '#a6a296',
    '#b4ab8f', '#bcb7a5'
  ],
  'darkseed-16': [
    '#000000', '#001418',
    '#002024', '#002c38',
    '#143444', '#443444',
    '#583c48', '#6c4c44',
    '#806058', '#6c706c',
    '#888078', '#a49484',
    '#c4ac9c', '#d8b0a8',
    '#ecd4d0', '#fcfcfc'
  ],
  'dawnbringer-16': [
    '#140c1c', '#442434',
    '#30346d', '#4e4a4e',
    '#854c30', '#346524',
    '#d04648', '#757161',
    '#597dce', '#d27d2c',
    '#8595a1', '#6daa2c',
    '#d2aa99', '#6dc2ca',
    '#dad45e', '#deeed6'
  ],
  'daylight-16': [
    '#f2d3ac', '#e7a76c',
    '#c28462', '#905b54',
    '#513a3d', '#7a6977',
    '#878c87', '#b5c69a',
    '#272223', '#606b31',
    '#b19e3f', '#f8c65c',
    '#d58b39', '#996336',
    '#6a422c', '#b55b39'
  ],
  'endesga-16': [
    '#e4a672', '#b86f50',
    '#743f39', '#3f2832',
    '#9e2835', '#e53b44',
    '#fb922b', '#ffe762',
    '#63c64d', '#327345',
    '#193d3f', '#4f6781',
    '#afbfd2', '#ffffff',
    '#2ce8f4', '#0484d1'
  ],
  'eroge-copper': [
    '#0d080d', '#4f2b24',
    '#825b31', '#c59154',
    '#f0bd77', '#fbdf9b',
    '#fff9e4', '#bebbb2',
    '#7bb24e', '#74adbb',
    '#4180a0', '#32535f',
    '#2a2349', '#7d3840',
    '#c16c5b', '#e89973'
  ],
  'fading-16': [
    '#ddcf99', '#cca87b',
    '#b97a60', '#9c524e',
    '#774251', '#4b3d44',
    '#4e5463', '#5b7d73',
    '#8e9f7d', '#645355',
    '#8c7c79', '#a99c8d',
    '#7d7b62', '#aaa25d',
    '#846d59', '#a88a5e'
  ],
  'galaxy-flame': [
    '#699fad', '#3a708e',
    '#2b454f', '#111215',
    '#151d1a', '#1d3230',
    '#314e3f', '#4f5d42',
    '#9a9f87', '#ede6cb',
    '#f5d893', '#e8b26f',
    '#b6834c', '#704d2b',
    '#40231e', '#151015'
  ],
  'go-line': [
    '#430067', '#94216a',
    '#ff004d', '#ff8426',
    '#ffdd34', '#50e112',
    '#3fa66f', '#365987',
    '#000000', '#0033ff',
    '#29adff', '#00ffcc',
    '#fff1e8', '#c2c3c7',
    '#ab5236', '#5f574f'
  ],
  'grayscale-16': [
    '#000000', '#181818',
    '#282828', '#383838',
    '#474747', '#565656',
    '#646464', '#717171',
    '#7e7e7e', '#8c8c8c',
    '#9b9b9b', '#ababab',
    '#bdbdbd', '#d1d1d1',
    '#e7e7e7', '#ffffff'
  ],
  'island-joy-16': [
    '#ffffff', '#6df7c1',
    '#11adc1', '#606c81',
    '#393457', '#1e8875',
    '#5bb361', '#a1e55a',
    '#f7e476', '#f99252',
    '#cb4d68', '#6a3771',
    '#c92464', '#f48cb6',
    '#f7b69e', '#9b9c82'
  ],
  'lost-century': [
    '#d1b187', '#c77b58',
    '#ae5d40', '#79444a',
    '#4b3d44', '#ba9158',
    '#927441', '#4d4539',
    '#77743b', '#b3a555',
    '#d2c9a5', '#8caba1',
    '#4b726e', '#574852',
    '#847875', '#ab9b8e'
  ],
  'microsoft-windows': [
    '#000000', '#7e7e7e',
    '#bebebe', '#ffffff',
    '#7e0000', '#fe0000',
    '#047e00', '#06ff04',
    '#7e7e00', '#ffff04',
    '#00007e', '#0000ff',
    '#7e007e', '#fe00ff',
    '#047e7e', '#06ffff'
  ],
  'miyazaki-16': [
    '#232228', '#284261',
    '#5f5854', '#878573',
    '#b8b095', '#c3d5c7',
    '#ebecdc', '#2485a6',
    '#54bad2', '#754d45',
    '#c65046', '#e6928a',
    '#1e7453', '#55a058',
    '#a1bf41', '#e3c054'
  ],
  na16: [
    '#8c8fae', '#584563',
    '#3e2137', '#9a6348',
    '#d79b7d', '#f5edba',
    '#c0c741', '#647d34',
    '#e4943a', '#9d303b',
    '#d26471', '#70377f',
    '#7ec4c1', '#34859d',
    '#17434b', '#1f0e1c'
  ],
  'nanner-jam': [
    '#352b40', '#653d48',
    '#933f45', '#b25e46',
    '#cc925e', '#dacb80',
    '#f0e9c9', '#76c379',
    '#508d76', '#535c89',
    '#7b99c8', '#99d4e6',
    '#be7979', '#d8b1a1',
    '#7d6e6e', '#c2b5a9'
  ],
  'pico-8': [
    '#000000', '#1D2B53',
    '#7E2553', '#008751',
    '#AB5236', '#5F574F',
    '#C2C3C7', '#FFF1E8',
    '#FF004D', '#FFA300',
    '#FFEC27', '#00E436',
    '#29ADFF', '#83769C',
    '#FF77A8', '#FFCCAA'
  ],
  'r-place': [
    '#FFFFFF', '#E4E4E4',
    '#888888', '#222222',
    '#FFA7D1', '#E50000',
    '#E59500', '#A06A42',
    '#E5D900', '#94E044',
    '#02BE01', '#00D3DD',
    '#0083C7', '#0000EA',
    '#CF6EE4', '#820080'
  ],
  'shido-cyberneon': [
    '#00033c', '#005260',
    '#009d4a', '#0aff52',
    '#003884', '#008ac5',
    '#00f7ff', '#ff5cff',
    '#ac29ce', '#600088',
    '#b10585', '#ff004e',
    '#2a2e79', '#4e6ea8',
    '#add4fa', '#ffffff'
  ],
  'steam-lords': [
    '#213b25', '#3a604a',
    '#4f7754', '#a19f7c',
    '#77744f', '#775c4f',
    '#603b3a', '#3b2137',
    '#170e19', '#2f213b',
    '#433a60', '#4f5277',
    '#65738c', '#7c94a1',
    '#a0b9ba', '#c0d1cc'
  ],
  'summers-past-16': [
    '#320011', '#5f3a60',
    '#876672', '#b7a39d',
    '#ece8c2', '#6db7c3',
    '#5e80b2', '#627057',
    '#8da24e', '#d2cb3e',
    '#f7d554', '#e8bf92',
    '#e78c5b', '#c66f5e',
    '#c33846', '#933942'
  ],
  'sweetie-16': [
    '#1a1c2c', '#5d275d',
    '#b13e53', '#ef7d57',
    '#ffcd75', '#a7f070',
    '#38b764', '#257179',
    '#29366f', '#3b5dc9',
    '#41a6f6', '#73eff7',
    '#f4f4f4', '#94b0c2',
    '#566c86', '#333c57'
  ],
  'taffy-16': [
    '#222533', '#6275ba',
    '#a3c0e6', '#fafffc',
    '#ffab7b', '#ff6c7a',
    '#dc435b', '#3f48c2',
    '#448de7', '#2bdb72',
    '#a7f547', '#ffeb33',
    '#f58931', '#db4b3d',
    '#a63d57', '#36354d'
  ],
  'urbex-16': [
    '#cbd1be', '#8f9389',
    '#52534c', '#26201d',
    '#e0a46e', '#91a47a',
    '#5d7643', '#4d533a',
    '#a93130', '#7a1338',
    '#834664', '#917692',
    '#160712', '#593084',
    '#3870be', '#579fb4'
  ],
  'vanilla-milkshake': [
    '#28282e', '#6c5671',
    '#d9c8bf', '#f98284',
    '#b0a9e4', '#accce4',
    '#b3e3da', '#feaae4',
    '#87a889', '#b0eb93',
    '#e9f59d', '#ffe6c6',
    '#dea38b', '#ffc384',
    '#fff7a0', '#fff7e4'
  ],
  woodspark: [
    '#f5eeb0', '#fabf61',
    '#e08d51', '#8a5865',
    '#452b3f', '#2c5e3b',
    '#609c4f', '#c6cc54',
    '#78c2d6', '#5479b0',
    '#56546e', '#839fa6',
    '#e0d3c8', '#f05b5b',
    '#8f325f', '#eb6c98'
  ]
};

 var colorPalette = [];

var images = new Array();
var imageCtxts = new Array();

function printCanvas(descriptionString){
    var canvas = document.createElement('canvas');
    canvas.width="160";
    canvas.height="100";
    var ctx=canvas.getContext("2d");
    for (var j=0;j<descriptionString.length;j++){
      var x = j%160;
      var y = Math.floor(j/160);
      var ch=descriptionString[j];
      var colIndex = parseInt(ch,16);
      ctx.fillStyle=colorPalette[colIndex];
      ctx.fillRect(x,y,1,1);
    }
    return [canvas,ctx];
}

function renderImages(){
  gameState.imageDats = new Array();

  for (var i=0;i<16;i++){
    var descriptionArray = gameState.canvasses[i];
    var descriptionString = RLE_decode(descriptionArray);

    var canvas_context=printCanvas(descriptionString);
    var canvas=canvas_context[0];
    var ctx=canvas_context[1];

    gameState.imageDats.push(descriptionString);
    images.push(canvas);
    imageCtxts.push(ctx);
  }
  redraw();
}

function goFullscreen(evt){    
  evt = evt || window.event;
 if (evt.keyCode===70) { //f
    var elem = document.getElementById("mainCanvas");
    if (elem.requestFullscreen) {
      elem.requestFullscreen();
    } else if (elem.msRequestFullscreen) {
      elem.msRequestFullscreen();
    } else if (elem.mozRequestFullScreen) {
      elem.mozRequestFullScreen();
    } else if (elem.webkitRequestFullscreen) {
      elem.webkitRequestFullscreen();
    }
  }
}
document.addEventListener("keydown", goFullscreen);

</script>
</head>
<body onload="init()" onkeydown="goFullscreen(event);">
<div id="header">
</div>
<p>
<div id="content">
<canvas id="mainCanvas"></canvas>
</div>
<p>
<div id="footer">
 <a href="http://www.flickgame.org" id="hackLink"></a> <a  id="homeLink" href="http://www.flickgame.org"></a> 
</div>
</body>
</html>